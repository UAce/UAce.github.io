<!DOCTYPE html> <html lang="en-US"> <head> <title>YouTubeStopwatch Chrome Extension - Yu-Yueh Liu</title> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale = 1.0, maximum-scale=1.0, user-scalable=no"/> <meta name="apple-mobile-web-app-capable" content="yes"/> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha384-Q8BgkilbsFGYNNiDqJm69hvDS7NCJWOodvfK/cwTyQD4VQA0qKzuPpvqNER1UC0F" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/zenburn.min.css"> <link rel="stylesheet" href="/assets/css/style.css"> <link rel="shortcut icon" class="favicon" type="image/svg" href="/assets/images/UA_favicon_dark.svg"> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha384-Zm+UU4tdcfAm29vg+MTbfu//q5B/lInMbMCr4T8c9rQFyOv6PlfQYpB5wItcXWe7" crossorigin="anonymous"></script> <script src="https://unpkg.com/sweet-scroll@4.0.0/sweet-scroll.min.js" integrity="sha384-YeNQy+x5Gp48/m1w+zup7sXeNzVPCC14WVR6+jevxGxvRw/1grCNT4QBzGg8b+ov" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js" integrity="sha384-3u0U01MLvyGLlqCxH5vNw55TTJ2zWaZDnxbCYz81kDzq3RYYXMVSDPLxPJu+jcCg" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <script>hljs.initLineNumbersOnLoad();</script> <script src="/assets/js/common.js"></script> <script src="/assets/js/check-dark-theme.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168212953-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-168212953-1");</script> <title>YouTubeStopwatch Chrome Extension | Yu-Yueh Liu</title> <meta name="generator" content="Jekyll v3.8.7"/> <meta property="og:title" content="YouTubeStopwatch Chrome Extension"/> <meta name="author" content="Yu-Yueh Liu"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Chrome extensions are programs that add functionalities to Chrome and enhance your browsing experience. In fact, you can find a myriad of extensions for the purpose of improving your productivity, protecting your privacy, and more. Making your own Chrome extension is quite simple and it could turn out to be a fun personal project. Goal This article is a documentation of what I learned when making my own Chrome extension. If you&#39;re looking for a tutorial for starters, check out the official Getting Started Tutorial. What is YouTubeStopwatch? YouTubeStopwatch was created for a course on Human-Computer Interaction (HCI). The objective was to help users manage the amount of time they would like to spend on YouTube, and somehow incite them to quit YouTube without resorting to blocking the site. The idea was to prompt the user for the desired time they want to spend on YouTube and start a countdown. Once the time is up, the user is asked whether they want to stay on YouTube or leave. If they choose to keep watching videos, they will be subject to some gradual graphical deterioration and slowly worsening their viewing experience. So how did I get started? Well, the first thing I had to learn was how Chrome Extensions are structured. Project Structure src ├── manifest.json ├── popup.html ├── js │ ├── background.js │ ├── content.js │ ├── jquery-3.4.1.min.js.js │ ├── constants.js │ └── ... ├── img │ └── extension-icon.png └── css └── popup.css Manifest The manifest.json file is the first thing you need when creating an extension. It provides all the information about your extension to Google Chrome such as the name of your extension, the permissions needed, etc but we&#39;ll get into that a bit later. Here is a minimal example: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot; } Background Scripts Background scripts are scripts that run in the background of your browser when you open Google Chrome. You can make the scripts persistent or not depending on your use case. I chose to use a persistent script. As long as Google Chrome is open, the script will be running. To define background scripts, I added a background section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; ], &quot;persistent&quot;: true } } Note that it is now recommended to use non-persistent background scripts with Event Driven Background Scripts. Below is an example of what my background script looked like. // List to track all active YouTube tabs var active_youtube_tabs=[]; // Create Main Event Listener function initBackground() { chrome.runtime.onMessage.addListener(function (msg, sender) { var tabId=sender.tab ? sender.tab.id : null; // If sender is youtube, add listener if (msg.from === &#39;youtube&#39; &amp;&amp; typeof (msg.event) === &#39;undefined&#39;) { active_youtube_tabs.indexOf(tabId) &lt; 0 ? addListeners(tabId) : null; } // Handles event message switch (msg.event) { case &quot;START_COUNTDOWN&quot;: startCountdown(); break; ... default: break; } }); } initBackground(); // Subscribes tab to active youtube tabs and adds listener to url changes function addListeners(tabId) { active_youtube_tabs.push(tabId); // When a youtube tab is closed, remove tabId from active_youtube_tabs list chrome.tabs.onRemoved.addListener(function (id) { if (tabId === id) { removeYoutubeTab(tabId); } }); // When the tab url changes, remove tabId from active_youtube_tabs if user is no longer on Youtube chrome.tabs.onUpdated.addListener(function (id, changeInfo) { if (tabId === id &amp;&amp; changeInfo.status === &#39;complete&#39;) { chrome.tabs.get(tabId, function (tab) { if (tab.url.indexOf(&#39;youtube.com&#39;) &lt; 0) { removeYoutubeTab(tabId); } }); } }); } // Removes specific tab from active_youtube_tabs list function removeYoutubeTab(tabId) { var idx=active_youtube_tabs.indexOf(tabId); active_youtube_tabs.splice(idx, 1); } When the script starts, a callback function is added with onMessage.addListener() to handle events. Depending on the event received, a different action will be triggered. For example, the START_COUNTDOWN event will start the countdown in the background script. The tabId is stored in a list to keep track of active youtube tabs if the sender is youtube. This is done using the Chrome Tabs API and we need to give permissions to our application in the manifest file. I needed to use JQuery in the background script so I downloaded the jquery-3.4.1.min.js file, saved it in the js directory and specified the file as a background script. Here are the new changes to the manifest file: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true } } Content Scripts Content Scripts are run on specific web pages and can interact with a website&#39;s DOM. To define a content script, I added a content_scripts section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true }, &quot;content_scripts&quot;: [ { &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ], &quot;js&quot;: [ &quot;js/jquery-3.4.1.min.js&quot;, &quot;js/content.js&quot; ], &quot;run_at&quot;: &quot;document_end&quot; } ] } The &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ] section tells Chrome to run the content scripts when the URL of the website matches the values specified. The &quot;run_at&quot;: &quot;document_end&quot; section ensures that the content scripts are run after the page is loaded. Popup Web Resources Constants …"/> <meta property="og:description" content="Chrome extensions are programs that add functionalities to Chrome and enhance your browsing experience. In fact, you can find a myriad of extensions for the purpose of improving your productivity, protecting your privacy, and more. Making your own Chrome extension is quite simple and it could turn out to be a fun personal project. Goal This article is a documentation of what I learned when making my own Chrome extension. If you&#39;re looking for a tutorial for starters, check out the official Getting Started Tutorial. What is YouTubeStopwatch? YouTubeStopwatch was created for a course on Human-Computer Interaction (HCI). The objective was to help users manage the amount of time they would like to spend on YouTube, and somehow incite them to quit YouTube without resorting to blocking the site. The idea was to prompt the user for the desired time they want to spend on YouTube and start a countdown. Once the time is up, the user is asked whether they want to stay on YouTube or leave. If they choose to keep watching videos, they will be subject to some gradual graphical deterioration and slowly worsening their viewing experience. So how did I get started? Well, the first thing I had to learn was how Chrome Extensions are structured. Project Structure src ├── manifest.json ├── popup.html ├── js │ ├── background.js │ ├── content.js │ ├── jquery-3.4.1.min.js.js │ ├── constants.js │ └── ... ├── img │ └── extension-icon.png └── css └── popup.css Manifest The manifest.json file is the first thing you need when creating an extension. It provides all the information about your extension to Google Chrome such as the name of your extension, the permissions needed, etc but we&#39;ll get into that a bit later. Here is a minimal example: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot; } Background Scripts Background scripts are scripts that run in the background of your browser when you open Google Chrome. You can make the scripts persistent or not depending on your use case. I chose to use a persistent script. As long as Google Chrome is open, the script will be running. To define background scripts, I added a background section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; ], &quot;persistent&quot;: true } } Note that it is now recommended to use non-persistent background scripts with Event Driven Background Scripts. Below is an example of what my background script looked like. // List to track all active YouTube tabs var active_youtube_tabs=[]; // Create Main Event Listener function initBackground() { chrome.runtime.onMessage.addListener(function (msg, sender) { var tabId=sender.tab ? sender.tab.id : null; // If sender is youtube, add listener if (msg.from === &#39;youtube&#39; &amp;&amp; typeof (msg.event) === &#39;undefined&#39;) { active_youtube_tabs.indexOf(tabId) &lt; 0 ? addListeners(tabId) : null; } // Handles event message switch (msg.event) { case &quot;START_COUNTDOWN&quot;: startCountdown(); break; ... default: break; } }); } initBackground(); // Subscribes tab to active youtube tabs and adds listener to url changes function addListeners(tabId) { active_youtube_tabs.push(tabId); // When a youtube tab is closed, remove tabId from active_youtube_tabs list chrome.tabs.onRemoved.addListener(function (id) { if (tabId === id) { removeYoutubeTab(tabId); } }); // When the tab url changes, remove tabId from active_youtube_tabs if user is no longer on Youtube chrome.tabs.onUpdated.addListener(function (id, changeInfo) { if (tabId === id &amp;&amp; changeInfo.status === &#39;complete&#39;) { chrome.tabs.get(tabId, function (tab) { if (tab.url.indexOf(&#39;youtube.com&#39;) &lt; 0) { removeYoutubeTab(tabId); } }); } }); } // Removes specific tab from active_youtube_tabs list function removeYoutubeTab(tabId) { var idx=active_youtube_tabs.indexOf(tabId); active_youtube_tabs.splice(idx, 1); } When the script starts, a callback function is added with onMessage.addListener() to handle events. Depending on the event received, a different action will be triggered. For example, the START_COUNTDOWN event will start the countdown in the background script. The tabId is stored in a list to keep track of active youtube tabs if the sender is youtube. This is done using the Chrome Tabs API and we need to give permissions to our application in the manifest file. I needed to use JQuery in the background script so I downloaded the jquery-3.4.1.min.js file, saved it in the js directory and specified the file as a background script. Here are the new changes to the manifest file: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true } } Content Scripts Content Scripts are run on specific web pages and can interact with a website&#39;s DOM. To define a content script, I added a content_scripts section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true }, &quot;content_scripts&quot;: [ { &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ], &quot;js&quot;: [ &quot;js/jquery-3.4.1.min.js&quot;, &quot;js/content.js&quot; ], &quot;run_at&quot;: &quot;document_end&quot; } ] } The &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ] section tells Chrome to run the content scripts when the URL of the website matches the values specified. The &quot;run_at&quot;: &quot;document_end&quot; section ensures that the content scripts are run after the page is loaded. Popup Web Resources Constants …"/> <link rel="canonical" href="https://uace.github.io/2020/09/03/youtubestopwatch-chrome-extension/"/> <meta property="og:url" content="https://uace.github.io/2020/09/03/youtubestopwatch-chrome-extension/"/> <meta property="og:site_name" content="Yu-Yueh Liu"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2020-09-03T07:27:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="YouTubeStopwatch Chrome Extension"/> <script type="application/ld+json">
{"description":"Chrome extensions are programs that add functionalities to Chrome and enhance your browsing experience. In fact, you can find a myriad of extensions for the purpose of improving your productivity, protecting your privacy, and more. Making your own Chrome extension is quite simple and it could turn out to be a fun personal project. Goal This article is a documentation of what I learned when making my own Chrome extension. If you&#39;re looking for a tutorial for starters, check out the official Getting Started Tutorial. What is YouTubeStopwatch? YouTubeStopwatch was created for a course on Human-Computer Interaction (HCI). The objective was to help users manage the amount of time they would like to spend on YouTube, and somehow incite them to quit YouTube without resorting to blocking the site. The idea was to prompt the user for the desired time they want to spend on YouTube and start a countdown. Once the time is up, the user is asked whether they want to stay on YouTube or leave. If they choose to keep watching videos, they will be subject to some gradual graphical deterioration and slowly worsening their viewing experience. So how did I get started? Well, the first thing I had to learn was how Chrome Extensions are structured. Project Structure src ├── manifest.json ├── popup.html ├── js │ ├── background.js │ ├── content.js │ ├── jquery-3.4.1.min.js.js │ ├── constants.js │ └── ... ├── img │ └── extension-icon.png └── css └── popup.css Manifest The manifest.json file is the first thing you need when creating an extension. It provides all the information about your extension to Google Chrome such as the name of your extension, the permissions needed, etc but we&#39;ll get into that a bit later. Here is a minimal example: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot; } Background Scripts Background scripts are scripts that run in the background of your browser when you open Google Chrome. You can make the scripts persistent or not depending on your use case. I chose to use a persistent script. As long as Google Chrome is open, the script will be running. To define background scripts, I added a background section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; ], &quot;persistent&quot;: true } } Note that it is now recommended to use non-persistent background scripts with Event Driven Background Scripts. Below is an example of what my background script looked like. // List to track all active YouTube tabs var active_youtube_tabs = []; // Create Main Event Listener function initBackground() { chrome.runtime.onMessage.addListener(function (msg, sender) { var tabId = sender.tab ? sender.tab.id : null; // If sender is youtube, add listener if (msg.from === &#39;youtube&#39; &amp;&amp; typeof (msg.event) === &#39;undefined&#39;) { active_youtube_tabs.indexOf(tabId) &lt; 0 ? addListeners(tabId) : null; } // Handles event message switch (msg.event) { case &quot;START_COUNTDOWN&quot;: startCountdown(); break; ... default: break; } }); } initBackground(); // Subscribes tab to active youtube tabs and adds listener to url changes function addListeners(tabId) { active_youtube_tabs.push(tabId); // When a youtube tab is closed, remove tabId from active_youtube_tabs list chrome.tabs.onRemoved.addListener(function (id) { if (tabId === id) { removeYoutubeTab(tabId); } }); // When the tab url changes, remove tabId from active_youtube_tabs if user is no longer on Youtube chrome.tabs.onUpdated.addListener(function (id, changeInfo) { if (tabId === id &amp;&amp; changeInfo.status === &#39;complete&#39;) { chrome.tabs.get(tabId, function (tab) { if (tab.url.indexOf(&#39;youtube.com&#39;) &lt; 0) { removeYoutubeTab(tabId); } }); } }); } // Removes specific tab from active_youtube_tabs list function removeYoutubeTab(tabId) { var idx = active_youtube_tabs.indexOf(tabId); active_youtube_tabs.splice(idx, 1); } When the script starts, a callback function is added with onMessage.addListener() to handle events. Depending on the event received, a different action will be triggered. For example, the START_COUNTDOWN event will start the countdown in the background script. The tabId is stored in a list to keep track of active youtube tabs if the sender is youtube. This is done using the Chrome Tabs API and we need to give permissions to our application in the manifest file. I needed to use JQuery in the background script so I downloaded the jquery-3.4.1.min.js file, saved it in the js directory and specified the file as a background script. Here are the new changes to the manifest file: { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true } } Content Scripts Content Scripts are run on specific web pages and can interact with a website&#39;s DOM. To define a content script, I added a content_scripts section to the manifest file. { &quot;manifest_version&quot;: 2, &quot;version&quot;: &quot;0.1&quot;, &quot;name&quot;: &quot;My Extension&quot;, &quot;description&quot;: &quot;This is my extension&quot;, &quot;permissions&quot;: [ &quot;tabs&quot; ], &quot;background&quot;: { &quot;scripts&quot;: [ &quot;js/background.js&quot; &quot;js/jquery-3.4.1.min.js&quot; ], &quot;persistent&quot;: true }, &quot;content_scripts&quot;: [ { &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ], &quot;js&quot;: [ &quot;js/jquery-3.4.1.min.js&quot;, &quot;js/content.js&quot; ], &quot;run_at&quot;: &quot;document_end&quot; } ] } The &quot;matches&quot;: [ &quot;*://*.youtube.com/*&quot; ] section tells Chrome to run the content scripts when the URL of the website matches the values specified. The &quot;run_at&quot;: &quot;document_end&quot; section ensures that the content scripts are run after the page is loaded. Popup Web Resources Constants …","author":{"@type":"Person","name":"Yu-Yueh Liu"},"@type":"BlogPosting","url":"https://uace.github.io/2020/09/03/youtubestopwatch-chrome-extension/","headline":"YouTubeStopwatch Chrome Extension","dateModified":"2020-09-03T07:27:00+00:00","datePublished":"2020-09-03T07:27:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uace.github.io/2020/09/03/youtubestopwatch-chrome-extension/"},"@context":"https://schema.org"}</script> </head> <body> <link rel="icon" id="light-favicon" href="/assets/images/UA_favicon_light.svg" type="image/svg"/> <link rel="icon" id="dark-favicon" href="/assets/images/UA_favicon_dark.svg" type="image/svg"/> <button id="scroll-to-top" title="Scroll to top">Top</button> <nav id="navbar" class="navbar fixed-top navbar-expand-sm justify-content-between"> <a class="navbar-brand mb-0 h1 add-margin-left-normal add-padding-bottom-small" href="/"> <img src="/assets/images/UA_favicon_dark.svg" width="40" height="30" class="d-inline-block home-logo favicon" alt="UA"> <span class="home-title">Yu-Yueh Liu</span> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation" onclick="toggleNavbar()"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarNavAltMarkup"> <div class="navbar-nav nav nav-pills ml-auto text-right"> <a class="nav-item nav-link " id="tab-Articles" href="/articles">Articles</a> <a class="nav-item nav-link " id="tab-Resume" href="/resume">Resume</a> <a class="nav-item nav-link " id="tab-About me" href="/about">About me</a> <a id="theme-icon-wrapper" onclick="modeSwitcher()"><i id="theme-icon" class="icon fas fa-lg"></i></a> </div> </div> </nav> <main class="main-body"> <article class="container post-container"> <header class="post-header"> <h1 class="post-title">YouTubeStopwatch Chrome Extension</h1> <p class="post-meta"> <a href="/about#me"> <img src="/assets/images/yueh.png" width="48" height="48" class="icon-avatar img-fluid img-thumbnail" alt="Me"> </a> <time class="post-datetime" datetime="2020-09-03T07:27:00+00:00">Sep 3, 2020 </time> <span class="bullet-before"> </span><i class="far fa-clock"></i> 9 min to read </p> <span class="post-tags"> <a href="_blank" class="tag" data-proofer-ignore> <span>JavaScript</span> </a> <a href="_blank" class="tag" data-proofer-ignore> <span>HTML5</span> </a> <a href="_blank" class="tag" data-proofer-ignore> <span>CSS3</span> </a> <a href="_blank" class="tag" data-proofer-ignore> <span>Chrome Extension</span> </a> </span> </header> <div class="post-body"> <p>Chrome extensions are programs that add functionalities to Chrome and enhance your browsing experience. In fact, you can find a myriad of extensions for the purpose of improving your productivity, protecting your privacy, and more. Making your own Chrome extension is quite simple and it could turn out to be a fun personal project.</p> <h4>Goal</h4> <p>This article is a documentation of what I learned when making my own Chrome extension. If you're looking for a tutorial for starters, check out the official <a href="https://developer.chrome.com/extensions/getstarted" target="_blank" class="bold">Getting Started Tutorial</a>.</p> <h4>What is YouTubeStopwatch?</h4> <p><a href="https://chrome.google.com/webstore/detail/youtubestopwatch/ibaejmohdpnppkglomilmholhndaobag" target="_blank" class="bold">YouTubeStopwatch</a> was created for a course on Human-Computer Interaction (HCI). The objective was to help users manage the amount of time they would like to spend on YouTube, and somehow incite them to quit YouTube without resorting to blocking the site.</p> <p>The idea was to prompt the user for the desired time they want to spend on YouTube and start a countdown. Once the time is up, the user is asked whether they want to stay on YouTube or leave. If they choose to keep watching videos, they will be subject to some gradual graphical deterioration and slowly worsening their viewing experience.</p> <p>So how did I get started? Well, the first thing I had to learn was how Chrome Extensions are structured.</p> <h2>Project Structure</h2> <pre class="highlight"><code class="nohljsln markdown">src
├── manifest.json
├── popup.html
├── js
│   ├── background.js
│   ├── content.js
│   ├── jquery-3.4.1.min.js.js
│   ├── constants.js
│   └──  ...
├── img
│   └──  extension-icon.png
└── css
    └──  popup.css
</code></pre> <h2>Manifest</h2> <p> The <code class="inline-code">manifest.json</code> file is the first thing you need when creating an extension. It provides all the information about your extension to Google Chrome such as the name of your extension, the permissions needed, etc but we'll get into that a bit later. Here is a minimal example: </p> <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Extension"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is my extension"</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <h2>Background Scripts</h2> <p> Background scripts are scripts that run in the background of your browser when you open Google Chrome. You can make the scripts persistent or not depending on your use case. I chose to use a persistent script. As long as Google Chrome is open, the script will be running. To define background scripts, I added a <strong>background</strong> section to the <b>manifest</b> file. </p> <pre class="highlight"><code>{
    "manifest_version": 2,
    "version": "0.1",
    "name": "My Extension",
    "description": "This is my extension",
<span class="hl-line">    "background": {</span>
<span class="hl-line">        "scripts": [</span>
<span class="hl-line">            "js/background.js"</span>
<span class="hl-line">        ],</span>
<span class="hl-line">        "persistent": true</span>
<span class="hl-line">    }</span>
}</code></pre> <p><i><b>Note</b> that it is now recommended to use non-persistent background scripts with <a href="https://developer.chrome.com/extensions/background_migration">Event Driven Background Scripts</a>.</i></p> <p>Below is an example of what my background script looked like.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">// List to track all active YouTube tabs</span>
<span class="kd">var</span> <span class="nx">active_youtube_tabs</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Create Main Event Listener</span>
<span class="kd">function</span> <span class="nx">initBackground</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onMessage</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">tabId</span> <span class="o">=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">tab</span> <span class="p">?</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">tab</span><span class="p">.</span><span class="nx">id</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="c1">// If sender is youtube, add listener</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="k">from</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">youtube</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">active_youtube_tabs</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tabId</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">addListeners</span><span class="p">(</span><span class="nx">tabId</span><span class="p">)</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// Handles event message</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="dl">"</span><span class="s2">START_COUNTDOWN</span><span class="dl">"</span><span class="p">:</span>
                <span class="nx">startCountdown</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">...</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="nx">initBackground</span><span class="p">();</span>

<span class="c1">// Subscribes tab to active youtube tabs and adds listener to url changes</span>
<span class="kd">function</span> <span class="nx">addListeners</span><span class="p">(</span><span class="nx">tabId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">active_youtube_tabs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tabId</span><span class="p">);</span>
    <span class="c1">// When a youtube tab is closed, remove tabId from active_youtube_tabs list</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">onRemoved</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">tabId</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">removeYoutubeTab</span><span class="p">(</span><span class="nx">tabId</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// When the tab url changes, remove tabId from active_youtube_tabs if user is no longer on Youtube</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">onUpdated</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">changeInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">tabId</span> <span class="o">===</span> <span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">changeInfo</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">tabId</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tab</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">tab</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">youtube.com</span><span class="dl">'</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">removeYoutubeTab</span><span class="p">(</span><span class="nx">tabId</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Removes specific tab from active_youtube_tabs list</span>
<span class="kd">function</span> <span class="nx">removeYoutubeTab</span><span class="p">(</span><span class="nx">tabId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">active_youtube_tabs</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tabId</span><span class="p">);</span>
    <span class="nx">active_youtube_tabs</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p> When the script starts, a callback function is added with <code class="inline-code">onMessage.addListener()</code> to handle events. Depending on the event received, a different action will be triggered. For example, the <span class="accent">START_COUNTDOWN</span> event will start the countdown in the background script. The tabId is stored in a list to keep track of active youtube tabs if the sender is youtube. This is done using the Chrome Tabs API and we need to give permissions to our application in the manifest file. </p> <p> I needed to use JQuery in the background script so I downloaded the <i>jquery-3.4.1.min.js</i> file, saved it in the <b>js</b> directory and specified the file as a background script. Here are the new changes to the manifest file: </p> <pre class="highlight"><code>{
    "manifest_version": 2,
    "version": "0.1",
    "name": "My Extension",
    "description": "This is my extension",
<span class="hl-line">    "permissions": [</span>
<span class="hl-line">        "tabs"</span>
<span class="hl-line">    ],</span>
    "background": {
        "scripts": [
            "js/background.js"
<span class="hl-line">            "js/jquery-3.4.1.min.js"</span>
        ],
        "persistent": true
    }
}</code></pre> <h2>Content Scripts</h2> <p> Content Scripts are run on specific web pages and can interact with a website's DOM. To define a content script, I added a <b>content_scripts</b> section to the <b>manifest</b> file. </p> <pre class="highlight"><code>{
    "manifest_version": 2,
    "version": "0.1",
    "name": "My Extension",
    "description": "This is my extension",
    "permissions": [
        "tabs"
    ],
    "background": {
        "scripts": [
            "js/background.js"
            "js/jquery-3.4.1.min.js"
        ],
        "persistent": true
    },
<span class="hl-line">    "content_scripts": [</span>
<span class="hl-line">        {</span>
<span class="hl-line">            "matches": [</span>
<span class="hl-line">                "*://*.youtube.com/*"</span>
<span class="hl-line">            ],</span>
<span class="hl-line">            "js": [</span>
<span class="hl-line">                "js/jquery-3.4.1.min.js",</span>
<span class="hl-line">                "js/content.js"</span>
<span class="hl-line">            ],</span>
<span class="hl-line">            "run_at": "document_end"</span>
<span class="hl-line">        }</span>
<span class="hl-line">    ]</span>
}</code></pre> <p> The <code class="inline-code">"matches": [ "*://*.youtube.com/*" ]</code> section tells Chrome to run the content scripts when the URL of the website matches the values specified. The <code class="inline-code">"run_at": "document_end"</code> section ensures that the content scripts are run after the page is loaded. </p> <h2>Popup</h2> <p> </p> <h2>Web Resources</h2> <p> </p> <h2>Constants</h2> <p> </p> <p>…</p> </div> </article> </main> <footer> <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha384-ujbKXb9V3HdK7jcWL6kHL1c+2Lj4MR4Gkjl7UtwpSHg/ClpViddK9TI7yU53frPN" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script> <script src="/assets/js/theme-switcher.js"></script> <div class="row align-items-center"> <span class="col-md-12 text-center"> © 2020 Yu-Yueh Liu ｜ <a href="https://www.youtube.com/watch?v=XvR-kTUad6U" target="_blank">Plus Ultra</a> ｜ <a href="feed.xml" data-proofer-ignore>RSS <i class="fas fa-rss"></i></a> ｜ <a href="sitemap.xml" data-proofer-ignore>Sitemap</a> </span> </div> </footer> </body> </html>